{% extends 'layouts/base.html' %}

{% block title %}Imagenes{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10">
    <h1 class="text-2xl font-bold mb-6">Reportes de Pacientes</h1>
    <form method="GET" action="/reportes" x-data="{ search: '', selected: null }">
        <input type="text" name="q" x-model="search" placeholder="Buscar paciente por nombre o apellido..." class="w-full px-4 py-2 border rounded mb-4" autocomplete="off">
        <div class="flex">
            <ul class="bg-white rounded shadow divide-y max-h-60 overflow-y-auto flex-1">
                {% for paciente in pacientes %}
                    <li x-show="search === '' || '{{ paciente.mod_pac_nombre }} {{ paciente.mod_pac_apellido }}'.toLowerCase().includes(search.toLowerCase())"
                        :class="selected === {{ paciente.mod_pac_id }} ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'cursor-pointer hover:bg-indigo-100'"
                        class="px-4 py-2 transition"
                        @click.prevent="selected = {{ paciente.mod_pac_id }}">
                        {{ paciente.mod_pac_nombre }} {{ paciente.mod_pac_apellido }}
                    </li>
                {% endfor %}
            </ul>
            <template x-if="selected">
                <div class="flex items-center pl-4">
                    <a :href="'/reportes/' + selected" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded font-semibold whitespace-nowrap">Ver reporte PDF</a>
                </div>
            </template>
        </div>
    </form>
    {% if paciente_seleccionado %}
        <div class="mt-10">
            <h2 class="text-xl font-semibold mb-4">Datos del Paciente</h2>
            <div class="bg-gray-50 rounded p-4 mb-6">
                <p><strong>Nombre:</strong> {{ paciente_seleccionado.mod_pac_nombre }} {{ paciente_seleccionado.mod_pac_apellido }}</p>
                <p><strong>CI:</strong> {{ paciente_seleccionado.mod_pac_ci }}</p>
                <p><strong>Fecha de nacimiento:</strong> {{ paciente_seleccionado.mod_pac_fecha_nacimiento }}</p>
                <p><strong>Teléfono:</strong> {{ paciente_seleccionado.mod_pac_telefono }}</p>
                <p><strong>Email:</strong> {{ paciente_seleccionado.mod_pac_email }}</p>
                <p><strong>Observaciones:</strong> {{ paciente_seleccionado.mod_pac_observaciones }}</p>
            </div>
            <h3 class="text-lg font-semibold mb-2">Radiografía principal</h3>
            {% if imagen_principal %}
                <img src="{{ url_for('static', filename=imagen_principal) }}" alt="Radiografía del paciente" class="w-full max-w-md rounded shadow">
            {% else %}
                <p class="text-gray-400 italic">No hay radiografía registrada para este paciente.</p>
            {% endif %}
            <div class="mt-6">
                <a href="{{ url_for('main.reporte_pdf', paciente_id=paciente_seleccionado.mod_pac_id) }}" target="_blank" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded font-semibold">Descargar PDF</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}